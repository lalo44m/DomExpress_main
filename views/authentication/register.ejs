<%- include('../partials/header') %>
<title>Registro</title>
</head>
<body>
<%- include('../partials/navbar') %>

<!-- <script src="https://www.google.com/recaptcha/api.js" async defer></script> -->
<main>
  <div class="container-fluid my-2">
     <% if(register!=""){%>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <%= register %> 
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    <%}%>
  </div>
  <div class="container-fluid my-2">
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        Estás a un paso de ser parte de DomotiqueXperience
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  </div>
    <div class="container">
        <h2 class="text-center mt-5">Regístrate</h2>
       
        <div class="form-section d-flex justify-content-center align-items-center" >
            <form action="/register" method="post" class="register-form needs-validation res-width" id="register-form" enctype="multipart/form-data" novalidate>
                <!-- 2 column grid layout with text inputs for the first and last names -->
                <div class="mb-5">
                  <div class="image-port">
                    <img src="https://toppng.com/uploads/preview/app-icon-set-login-icon-comments-avatar-icon-11553436380yill0nchdm.png" height="90px" width="90px" class="profile-photo m-auto" id="dp-pick">
                  </div>
                    <input type="file" class="form-control" accept=".jpg, .png, .jpeg" name="image" id="files"/>
                    <!-- <div class="valid-feedback">¡Los datos son correctos!</div> -->
                    <div class="invalid-feedback">*Campo requerido</div>
                </div>
             
                    <div class="form-outline mb-5">
                      <input type="text" id="nombreCompleto" class="form-control" name="nombreCompleto" required />
                      <label class="form-label" for="nombreCompleto">Nombre completo</label>
                      <!-- <div class="valid-feedback">¡Los datos son correctos!</div> -->
                      <div class="invalid-feedback">*Campo requerido</div>
                    </div>
                    <div class="form-outline mb-5">
                      <input type="text" id="username" class="form-control" name="username" required />
                      <label class="form-label" for="username">Nombre de usuario</label>
                      <!-- <div class="valid-feedback">¡Los datos son correctos!</div> -->
                      <div class="invalid-feedback">*Campo requerido</div>
                    </div>
                  
                <!-- Email input -->
                <div class="form-outline mb-5">
                  <input type="email" id="email" class="form-control" name="email" required />
                  <label class="form-label" for="email">Email</label>
                  <!-- <div class="valid-feedback">¡Los datos son correctos!</div> -->
                  <div class="invalid-feedback">*Campo requerido</div>
                </div>
                <div class="form-outline mb-5">
                    <input type="tel" class="form-control" id="telefono" name="telefono" value="+52" required>
                    <label class="form-label" for="email">Numero de telefono</label>
                    <!-- <div class="valid-feedback">¡Los datos son correctos!</div> -->
                    <div class="invalid-feedback">*Campo requerido</div>
                  </div>
              
                <!-- Password input -->
                <div class="form-outline mb-5">
                  <input type="password" id="password" class="form-control" name="password" required oninput="validatePassword()" />
                  <label class="form-label" for="password">Contraseña</label>
                  <div class="valid-feedback">¡Los datos son correctos!</div>
                  <div class="invalid-feedback" id="password-feedback">*Campo requerido</div>
                </div>

                <div class="form-outline mb-5">
                  <input type="password" id="password2" class="form-control" name="pwd2" required oninput="validatePassword()" />
                  <label class="form-label" for="password2">Confirmar Contraseña</label>
                  <div class="valid-feedback">¡Las contraseñas coinciden!</div>
                  <div class="invalid-feedback" id="password2-feedback">*Campo requerido</div>
                </div>
                
                <button type="button" class="btn btn-primary" onclick="showPassword()">Mostrar</button>
                <div style="margin-top: 2rem;" class="alert alert-warning alert-dismissible fade show mb-4" role="alert">
                  <span>Por favor, crea una contraseña que tenga al menos 8 caracteres y que incluya una combinación de letras, números y símbolos</span>
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>

                <div class="col text-center justify-content-center">
                  <div class="d-flex justify-content-center">
                      <div class="g-recaptcha" data-sitekey="6LciE7YmAAAAACxNBXx4PfQ0NJ73V6VwLPyU4p-9" data-callback="verifyCaptcha" required></div>
                      
                  </div>
                  <div class="invalid-feedback" id="errorRecap" style="display: none;">El recaptcha es requerido</div>
                </div>

                
                <!-- Checkbox
                <div class="form-outline mb-4">
                  <label for="role" class="ms-2"><h6>User Role :</h6></label>
                  <select class="form-select" aria-label="role" name="role">
                    <option selected value="Customer">Customer</option>
                    <option value="Admin">Admin</option>
                  </select>
               
                </div> -->
                

                <!-- Submit button -->
                <button style="margin-top: 2rem;" type="button" class="btn btn-primary btn-block mb-4" onclick="validateForm()">Registrarse</button>
              
                <!-- Register buttons -->
                <div class="text-center">
                  <p>¿Ya tienes una cuenta? <a href="/login">Iniciar sesión</a> </p>
                  <!-- <p>or sign up with:</p>
                  <a href="/auth/google">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/53/Google_%22G%22_Logo.svg/512px-Google_%22G%22_Logo.svg.png" alt="Google Img" height="50px" width="50px">
                    </a> -->
                  
                </div>
              </form>
         </div>
    </div>

 </main>
 <script>
  function showPassword() {
    var x = document.getElementById("password");
    var y = document.getElementById("password2");
    if (x.type && y.type === "password") {
      x.type = "text";
      y.type = "text";
    } else {
      x.type = "password";
      y.type = "password";
    }
  }


  function validatePassword() {
    var password = document.getElementById("password").value;
    var password2 = document.getElementById("password2").value;
    var passwordFeedback = document.getElementById("password-feedback");
    var password2Feedback = document.getElementById("password2-feedback");
    var regex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[\W_]).{8,}$/;

    if (!regex.test(password)) {
      passwordFeedback.innerText = "La contraseña debe tener al menos 8 caracteres, incluyendo letras, números y símbolos.";
      document.getElementById("password").classList.add("is-invalid");
      document.getElementById("password").classList.remove("is-valid");
    } else {
      document.getElementById("password").classList.add("is-valid");
      document.getElementById("password").classList.remove("is-invalid");
    }

    if (password !== password2) {
      password2Feedback.innerText = "Las contraseñas no coinciden.";
      document.getElementById("password2").classList.add("is-invalid");
      document.getElementById("password2").classList.remove("is-valid");
    } else if (password2 !== "") {
      document.getElementById("password2").classList.add("is-valid");
      document.getElementById("password2").classList.remove("is-invalid");
    }
  }
  </script>
  
 <script>
   
   document.getElementById('files').onchange = function () {
     console.log("Hello There")
  var src = URL.createObjectURL(this.files[0])
  document.getElementById('dp-pick').src = src
}

//   function checkPassword(valor){
//     var myregex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$/; 
//    if(myregex.test(valor)){
//        swal("Oops!", valor + "es valido :-) !", "error")
//        return true;        
//    }else{
//       alert();
//      swal("Oops!", valor + "NO es valido!", "error")
//        return false;        
//    }   
//  }

//   function checkForm(form){
//     if(form.email.value == "") {
//         swal("Oops!", "Debe escribir el correo!", "error")
//       form.email.focus();
//       return false;
//     }
//     if(form.password.value != "" && form.password.value == form.pwd2.value) {
//       if(!checkPassword(form.pwd1.value)) {  
//         swal("Oops!", "La contraseña no es valida!", "error")
//         form.password.focus();
//         return false;
//       }
//     } else {
//       swal("Oops!", "las contraseñas no coinciden!", "error")
//       form.password.focus();
//       return false;
//     }
//     return true;
//   }
  function validateForm() {
    var form = document.getElementById("register-form");
    
    // Primero, forzar la validación HTML5
    if (form.checkValidity() === false) {
      form.classList.add('was-validated');
    } else {
      var recaptchaResponse = grecaptcha.getResponse();
      if (recaptchaResponse.length == 0) {
        document.getElementById("errorRecap").style.display = "block";
      } else {
        document.getElementById("errorRecap").style.display = "none";
        form.submit();
      }
    }
  }
</script>
<script src="https://www.google.com/recaptcha/api.js" async defer></script>

<%- include('../partials/footer') %> 